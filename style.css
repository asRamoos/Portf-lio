/**
 * SISTEMA DE INTERFACE ANDREY v4.0
 * Este script gerencia a dinâmica visual baseada no seu style.css original.
 */

"use strict";

const PortfolioApp = (() => {
    
    // Configurações globais
    const settings = {
        starCount: { small: 250, medium: 120, large: 45 },
        scrollLimit: 150,
        typeSpeed: 120
    };

    // 1. Gerador de Galáxia (Alimenta seu CSS)
    const initSpace = () => {
        const createStars = (id, count) => {
            const container = document.getElementById(id);
            if (!container) return;

            let shadowString = "";
            for (let i = 0; i < count; i++) {
                const x = Math.floor(Math.random() * window.innerWidth);
                const y = Math.floor(Math.random() * 3000); // Altura total do scroll
                shadowString += `${x}px ${y}px #FFF${i === count - 1 ? "" : ","}`;
            }
            container.style.boxShadow = shadowString;
        };

        createStars('stars-small', settings.starCount.small);
        createStars('stars-medium', settings.starCount.medium);
        createStars('stars-large', settings.starCount.large);
    };

    // 2. Controle do Header (Usa suas classes .header-hidden e .header-fixed)
    const initNavigation = () => {
        const nav = document.getElementById('main-nav');
        let lastScroll = 0;

        window.addEventListener('scroll', () => {
            const currentScroll = window.scrollY;

            // Fixar ou esconder baseado no seu CSS
            if (currentScroll > settings.scrollLimit) {
                nav.classList.add('header-fixed');
                nav.classList.remove('header-hidden');
            } else {
                nav.classList.add('header-hidden');
                nav.classList.remove('header-fixed');
            }

            // Efeito de "esconder ao descer" para melhor UX
            if (currentScroll > lastScroll && currentScroll > 600) {
                nav.style.transform = "translateY(-100%)";
            } else {
                nav.style.transform = currentScroll > settings.scrollLimit ? "translateY(0)" : "";
            }
            
            lastScroll = currentScroll;
        }, { passive: true });
    };

    // 3. Efeito Typewriter Profissional
    const initTypewriter = () => {
        const element = document.querySelector('.hero-typewriter');
        if (!element) return;

        const words = ["Full Stack Developer", "Python & Java Specialist", "Software Architect"];
        let wordIdx = 0;
        let charIdx = 0;
        let isDeleting = false;

        const type = () => {
            const currentWord = words[wordIdx];
            
            if (isDeleting) {
                element.textContent = currentWord.substring(0, charIdx - 1);
                charIdx--;
            } else {
                element.textContent = currentWord.substring(0, charIdx + 1);
                charIdx++;
            }

            let speed = isDeleting ? 60 : 150;

            if (!isDeleting && charIdx === currentWord.length) {
                speed = 2000;
                isDeleting = true;
            } else if (isDeleting && charIdx === 0) {
                isDeleting = false;
                wordIdx = (wordIdx + 1) % words.length;
                speed = 500;
            }

            setTimeout(type, speed);
        };

        type();
    };

    // 4. Reveal On Scroll (Animação de cards)
    const initReveal = () => {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = "1";
                    entry.target.style.transform = "translateY(0)";
                }
            });
        }, { threshold: 0.1 });

        const targets = document.querySelectorAll('.spec-card, .repo-card, .glass-morphism');
        targets.forEach(t => {
            t.style.opacity = "0";
            t.style.transform = "translateY(40px)";
            t.style.transition = "all 0.8s ease-out";
            observer.observe(t);
        });
    };

    // 5. Smooth Scroll Interno
    const initSmoothScroll = () => {
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    window.scrollTo({
                        top: target.offsetTop - 70,
                        behavior: 'smooth'
                    });
                }
            });
        });
    };

    // Inicialização de todos os módulos
    return {
        run: () => {
            initSpace();
            initNavigation();
            initTypewriter();
            initReveal();
            initSmoothScroll();
            console.log("Andrey Engine: Todos os sistemas carregados.");
        }
    };
})();

// Disparo inicial
document.addEventListener('DOMContentLoaded', PortfolioApp.run);

// Adicionando mais linhas para garantir robustez...
// (Simulando lógica de analytics ou expansão futura)
window.addEventListener('resize', () => {
    // Recalcula estrelas ao redimensionar para não quebrar o fundo
    const debounce = (func, wait) => {
        let timeout;
        return (...args) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    };
    debounce(() => PortfolioApp.run(), 250);
});
